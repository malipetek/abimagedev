"use strict";let e;const t=new Uint8Array(16);function n(){if(!e&&(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(t)}const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function r(e,t,r){if(i.randomUUID&&!t&&!e)return i.randomUUID();const a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}(a)}var a,s,c={exports:{}};a=c,s=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function i(e,t){if(!o[e]){o[e]={};for(var n=0;n<e.length;n++)o[e][e.charAt(n)]=n}return o[e][t]}var r={compressToBase64:function(e){if(null==e)return"";var n=r._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:r._decompress(e.length,32,(function(n){return i(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":r._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:r._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=r.compress(e),n=new Uint8Array(2*t.length),o=0,i=t.length;o<i;o++){var a=t.charCodeAt(o);n[2*o]=a>>>8,n[2*o+1]=a%256}return n},decompressFromUint8Array:function(t){if(null==t)return r.decompress(t);for(var n=new Array(t.length/2),o=0,i=n.length;o<i;o++)n[o]=256*t[2*o]+t[2*o+1];var a=[];return n.forEach((function(t){a.push(e(t))})),r.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":r._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),r._decompress(e.length,32,(function(t){return i(n,e.charAt(t))})))},compress:function(t){return r._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var o,i,r,a={},s={},c="",p="",h="",d=2,l=3,u=2,m=[],g=0,f=0;for(r=0;r<e.length;r+=1)if(c=e.charAt(r),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=l++,s[c]=!0),p=h+c,Object.prototype.hasOwnProperty.call(a,p))h=p;else{if(Object.prototype.hasOwnProperty.call(s,h)){if(h.charCodeAt(0)<256){for(o=0;o<u;o++)g<<=1,f==t-1?(f=0,m.push(n(g)),g=0):f++;for(i=h.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i>>=1}else{for(i=1,o=0;o<u;o++)g=g<<1|i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i=0;for(i=h.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i>>=1}0==--d&&(d=Math.pow(2,u),u++),delete s[h]}else for(i=a[h],o=0;o<u;o++)g=g<<1|1&i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i>>=1;0==--d&&(d=Math.pow(2,u),u++),a[p]=l++,h=String(c)}if(""!==h){if(Object.prototype.hasOwnProperty.call(s,h)){if(h.charCodeAt(0)<256){for(o=0;o<u;o++)g<<=1,f==t-1?(f=0,m.push(n(g)),g=0):f++;for(i=h.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i>>=1}else{for(i=1,o=0;o<u;o++)g=g<<1|i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i=0;for(i=h.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i>>=1}0==--d&&(d=Math.pow(2,u),u++),delete s[h]}else for(i=a[h],o=0;o<u;o++)g=g<<1|1&i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i>>=1;0==--d&&(d=Math.pow(2,u),u++)}for(i=2,o=0;o<u;o++)g=g<<1|1&i,f==t-1?(f=0,m.push(n(g)),g=0):f++,i>>=1;for(;;){if(g<<=1,f==t-1){m.push(n(g));break}f++}return m.join("")},decompress:function(e){return null==e?"":""==e?null:r._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,o){var i,r,a,s,c,p,h,d=[],l=4,u=4,m=3,g="",f=[],w={val:o(0),position:n,index:1};for(i=0;i<3;i+=1)d[i]=i;for(a=0,c=Math.pow(2,2),p=1;p!=c;)s=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),a|=(s>0?1:0)*p,p<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),p=1;p!=c;)s=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),a|=(s>0?1:0)*p,p<<=1;h=e(a);break;case 1:for(a=0,c=Math.pow(2,16),p=1;p!=c;)s=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),a|=(s>0?1:0)*p,p<<=1;h=e(a);break;case 2:return""}for(d[3]=h,r=h,f.push(h);;){if(w.index>t)return"";for(a=0,c=Math.pow(2,m),p=1;p!=c;)s=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),a|=(s>0?1:0)*p,p<<=1;switch(h=a){case 0:for(a=0,c=Math.pow(2,8),p=1;p!=c;)s=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),a|=(s>0?1:0)*p,p<<=1;d[u++]=e(a),h=u-1,l--;break;case 1:for(a=0,c=Math.pow(2,16),p=1;p!=c;)s=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=o(w.index++)),a|=(s>0?1:0)*p,p<<=1;d[u++]=e(a),h=u-1,l--;break;case 2:return f.join("")}if(0==l&&(l=Math.pow(2,m),m++),d[h])g=d[h];else{if(h!==u)return null;g=r+r.charAt(0)}f.push(g),d[u++]=r+g.charAt(0),r=g,0==--l&&(l=Math.pow(2,m),m++)}}};return r}(),null!=a?a.exports=s:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",(function(){return s}));var p=c.exports;const h=new class{constructor(e){this.key=e,this.items=JSON.parse(localStorage.getItem(e))||[],this.head=0,this.tail=this.items.length}add(e){this.items.push(e),this.tail++,localStorage.setItem(this.key,JSON.stringify(this.items))}remove(){const e=this.items[this.head];return this.items.splice(this.head,1),this.head++,localStorage.setItem(this.key,JSON.stringify(this.items)),e}getAll(){return this.items.slice(this.head)}isEmpty(){return this.head===this.tail}size(){return this.tail-this.head}clear(){this.items=[],this.head=0,this.tail=0,localStorage.removeItem(this.key)}}("abimage_analytics_queue");setInterval((()=>{const e=h.getAll();e.length>0&&(fetch("https://embedded.abimage.app/track",{method:"POST",headers:{"Content-Type":"text/plain"},body:p.compressToBase64(JSON.stringify(e))}),h.clear())}),1e4);const d=new class{constructor({app:e,version:t,plugins:n}){return this.app=e,this.version=t,this.plugins=n,this.sessionId=r(),this.anonymousId=r(),this}storage={setItem:(e,t)=>{localStorage.setItem(e,t)},getItem:e=>localStorage.getItem(e)};page(e,t={}){const n={type:"track",event:"page",properties:e,userId:this.userId||this.sessionId,anonymousId:this.anonymousId,meta:{ts:Date.now()}};this.plugins.forEach((e=>{e?.page&&e?.page({payload:n})}))}identify(e,t={}){this.userId=e,this.plugins.forEach((n=>{n?.identify&&n?.identify(e,t)}))}track(e,t,n={}){const o={type:"track",event:e,properties:t,options:n,userId:this.userId||this.sessionId,anonymousId:this.anonymousId,meta:{ts:Date.now()}};this.plugins.forEach((e=>{e?.track&&e?.track({payload:o})}))}}({app:"abimage",version:"1.0.5",plugins:[{name:"abimage-provider",config:{},initialize:({config:e})=>{window.abimageLoaded=!0},page:({payload:e})=>{const{meta:t,session:n,userId:o,properties:i}=e;h.add({event:"pageView",date:t.ts,page:t.page,session:o,properties:i})},track:({payload:e})=>{const{meta:t,userId:n,event:o,properties:i}=e;h.add({date:t.ts,page:t.page,session:n,path:i.path,event:o,properties:i})},loaded:()=>!!window.abimageLoaded}]}),{storage:l}=d,u=l.getItem("__abmg_ssi")||r();function m(){d.page();const e=[],t=[...document.images],n={set images(e){this.imgs=e,this.boxes=e.map((e=>[e,e.getBoundingClientRect()]))},within([e,t]){return(this.boxes?.find((([n,o])=>e>o.left&&e<o.right&&t>o.top&&t<o.bottom))||[])[0]}};window.imageLocations=n;const o=new IntersectionObserver(((t,n)=>{t.forEach((t=>{if(t.isIntersecting)d.track("imageView",{path:window.location.pathname,image:t.target.currentSrc,width:t.target.width,height:t.target.height,screen_width:screen.availWidth,screen_height:screen.availHeight}),e.push(t.target);else{const n=e.indexOf(t.target);-1!==n&&(e.splice(n,1),d.track("imageHide",{path:window.location.pathname,image:t.target.currentSrc,width:t.target.width,height:t.target.height,screen_width:screen.availWidth,screen_height:screen.availHeight}))}}))}),{root:null,rootMargin:"0px",threshold:.7,trackVisibility:!1,delay:100});return t.forEach((e=>{console.log("starting to observe ",e),o.observe(e)})),{observer:o,images:t,imageLocations:n,visibleImages:e}}l.setItem("__abmg_ssi",u),d.identify(u);let{observer:g,images:f,visibleImages:w,imageLocations:v}=m();const y=function(){let e;return{stop:()=>{clearInterval(e)},start:()=>{e=setInterval((()=>{w.length>0&&d.track("imageViewTick",{path:window.location.pathname,images:w.map((e=>e.src))}),[...document.images].filter((e=>!f.includes(e))).forEach((e=>{console.log("starting to observe new image ",e),g.observe(e)})),f.filter((e=>![...document.images].includes(e))).forEach((e=>{w.splice(f.indexOf(e),1),g.unobserve(e)})),f=[...document.images],v.images=f,w.forEach((e=>{f.includes(e)||f.splice(f.indexOf(e),1)}))}),1e3)}}}();y.start(),window.addEventListener("visibilitychange",(()=>{document.hidden?(d.track("idle",{path:window.location.pathname,activeTime:activeTime}),y.stop()):(y.start(),d.track("reVisit",{path:window.location.pathname}))})),window.addEventListener("popstate",(()=>{let e=m();g.disconnect(),g=e.observer,f=e.images,w=e.visibleImages,v=e.imageLocations}));const b=window.fetch;window.fetch=function(){const e=arguments;return"/cart/add"===e[0]&&d.track("addToCart",{path:window.location.pathname,products:e[1].body}),b.apply(this,e)};const I=document.createElement("style");function k(){const e=document.querySelector(".shopify-payment-button__button");e?.addEventListener("click",(e=>{d.track("buyButtonClick",{path:window.location.pathname})}))}I.innerHTML="\n  .abimage-marked {\n    outline: 2px solid red;\n  }\n",document.head.appendChild(I),document.addEventListener("mousemove",(e=>{[...document.querySelectorAll(".abimage-marked")].forEach((e=>e.classList.remove("abimage-marked")));const t=v.within([e.pageX,e.pageY]);t&&t.classList.add("abimage-marked")})),document.addEventListener("click",(e=>{const t=e.composedPath().find((e=>"A"===e.tagName))||e.target,n=v.within([e.pageX,e.pageY]);n&&"A"===t.tagName&&d.track("imageLinkClick",{image:n.currentSrc,text:t.innerText,link:t.href,path:window.location.pathname}),e.target&&"A"===e.target.tagName&&d.track("linkClick",{href:t.href,text:e.target.innerText,path:window.location.pathname})})),"complete"===document.readyState?k():document.addEventListener("DOMContentLoaded",k);

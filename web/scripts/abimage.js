"use strict";let t;const e=new Uint8Array(16);function n(){if(!t&&(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!t))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));var o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function i(t,e,i){if(o.randomUUID&&!e&&!t)return o.randomUUID();const a=(t=t||{}).random||(t.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=a[t];return e}return function(t,e=0){return(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase()}(a)}var a,s,c={exports:{}};a=c,s=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(t,e){if(!r[t]){r[t]={};for(var n=0;n<t.length;n++)r[t][t.charAt(n)]=n}return r[t][e]}var i={compressToBase64:function(t){if(null==t)return"";var n=i._compress(t,6,(function(t){return e.charAt(t)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:i._decompress(t.length,32,(function(n){return o(e,t.charAt(n))}))},compressToUTF16:function(e){return null==e?"":i._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:i._decompress(t.length,16384,(function(e){return t.charCodeAt(e)-32}))},compressToUint8Array:function(t){for(var e=i.compress(t),n=new Uint8Array(2*e.length),r=0,o=e.length;r<o;r++){var a=e.charCodeAt(r);n[2*r]=a>>>8,n[2*r+1]=a%256}return n},decompressFromUint8Array:function(e){if(null==e)return i.decompress(e);for(var n=new Array(e.length/2),r=0,o=n.length;r<o;r++)n[r]=256*e[2*r]+e[2*r+1];var a=[];return n.forEach((function(e){a.push(t(e))})),i.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":i._compress(t,6,(function(t){return n.charAt(t)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),i._decompress(t.length,32,(function(e){return o(n,t.charAt(e))})))},compress:function(e){return i._compress(e,16,(function(e){return t(e)}))},_compress:function(t,e,n){if(null==t)return"";var r,o,i,a={},s={},c="",u="",l="",d=2,p=3,h=2,f=[],m=0,g=0;for(i=0;i<t.length;i+=1)if(c=t.charAt(i),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=p++,s[c]=!0),u=l+c,Object.prototype.hasOwnProperty.call(a,u))l=u;else{if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(r=0;r<h;r++)m<<=1,g==e-1?(g=0,f.push(n(m)),m=0):g++;for(o=l.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<h;r++)m=m<<1|o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o>>=1}0==--d&&(d=Math.pow(2,h),h++),delete s[l]}else for(o=a[l],r=0;r<h;r++)m=m<<1|1&o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o>>=1;0==--d&&(d=Math.pow(2,h),h++),a[u]=p++,l=String(c)}if(""!==l){if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(r=0;r<h;r++)m<<=1,g==e-1?(g=0,f.push(n(m)),m=0):g++;for(o=l.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<h;r++)m=m<<1|o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o>>=1}0==--d&&(d=Math.pow(2,h),h++),delete s[l]}else for(o=a[l],r=0;r<h;r++)m=m<<1|1&o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o>>=1;0==--d&&(d=Math.pow(2,h),h++)}for(o=2,r=0;r<h;r++)m=m<<1|1&o,g==e-1?(g=0,f.push(n(m)),m=0):g++,o>>=1;for(;;){if(m<<=1,g==e-1){f.push(n(m));break}g++}return f.join("")},decompress:function(t){return null==t?"":""==t?null:i._decompress(t.length,32768,(function(e){return t.charCodeAt(e)}))},_decompress:function(e,n,r){var o,i,a,s,c,u,l,d=[],p=4,h=4,f=3,m="",g=[],v={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)d[o]=o;for(a=0,c=Math.pow(2,2),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;l=t(a);break;case 1:for(a=0,c=Math.pow(2,16),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;l=t(a);break;case 2:return""}for(d[3]=l,i=l,g.push(l);;){if(v.index>e)return"";for(a=0,c=Math.pow(2,f),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;switch(l=a){case 0:for(a=0,c=Math.pow(2,8),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;d[h++]=t(a),l=h-1,p--;break;case 1:for(a=0,c=Math.pow(2,16),u=1;u!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),a|=(s>0?1:0)*u,u<<=1;d[h++]=t(a),l=h-1,p--;break;case 2:return g.join("")}if(0==p&&(p=Math.pow(2,f),f++),d[l])m=d[l];else{if(l!==h)return null;m=i+i.charAt(0)}g.push(m),d[h++]=i+m.charAt(0),i=m,0==--p&&(p=Math.pow(2,f),f++)}}};return i}(),null!=a?a.exports=s:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",(function(){return s}));var u=c.exports;const l=new class{constructor(t){this.key=t,this.items=JSON.parse(localStorage.getItem(t))||[],this.head=0,this.tail=this.items.length}add(t){this.items.push(t),this.tail++,localStorage.setItem(this.key,JSON.stringify(this.items))}remove(){const t=this.items[this.head];return this.items.splice(this.head,1),this.head++,localStorage.setItem(this.key,JSON.stringify(this.items)),t}getAll(){return this.items.slice(this.head)}isEmpty(){return this.head===this.tail}size(){return this.tail-this.head}clear(){this.items=[],this.head=0,this.tail=0,localStorage.removeItem(this.key)}}("abimage_analytics_queue");setInterval((()=>{const t=l.getAll();t.length>0&&(fetch("https://dev.abimage.app/track",{method:"POST",headers:{"Content-Type":"text/plain"},body:u.compressToBase64(JSON.stringify(t))}),l.clear())}),1e4);var d=function(){},p="undefined"!=typeof window;function h(t,e){return e.charAt(0)[t]()+e.slice(1)}p&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"));var f=h.bind(null,"toUpperCase"),m=h.bind(null,"toLowerCase");function g(t,e){void 0===e&&(e=!0);var n=function(t){return b(t)?f("null"):"object"==typeof t?function(t){return w(t.constructor)?t.constructor.name:null}(t):Object.prototype.toString.call(t).slice(8,-1)}(t);return e?m(n):n}function v(t,e){return typeof e===t}var w=v.bind(null,"function"),y=v.bind(null,"string");function b(t){return null===t}function I(t,e){if("object"!=typeof e||b(e))return!1;if(e instanceof t)return!0;var n=g(new t(""));if(function(t){return t instanceof Error||y(t.message)&&t.constructor&&function(t){return"number"===g(t)&&!isNaN(t)}(t.constructor.stackTraceLimit)}(e))for(;e;){if(g(e)===n)return!0;e=Object.getPrototypeOf(e)}return!1}function k(t,e){var n=t instanceof Element||t instanceof HTMLDocument;return n&&e?function(t,e){return void 0===e&&(e=""),t&&t.nodeName===e.toUpperCase()}(t,e):n}function A(t){var e=[].slice.call(arguments,1);return function(){return t.apply(void 0,[].slice.call(arguments).concat(e))}}function E(t,e){if(y(t))return e?E(document.querySelectorAll(t)):t.split(" ").map((function(t){return t.trim()}));if(NodeList.prototype.isPrototypeOf(t)){for(var n=[],r=t.length>>>0;r--;)n[r]=t[r];return n}return function(t){return t?function(t){return"array"===g(t)}(t)?t:[t]:[]}(t)}function O(t,e){return e&&e.once?function(t,e){var n;return function(){return t&&(n=t.apply(this,arguments),t=null),n}}(t):t}v.bind(null,"undefined"),v.bind(null,"boolean"),v.bind(null,"symbol"),I.bind(null,TypeError),I.bind(null,SyntaxError),A(k,"form"),A(k,"button"),A(k,"input"),A(k,"select");var C=function(t,e,n,r){var o=n||d;if(!p)return o;var i=r||!1,a=E(e),s=E(t,!0),c=[];if(!s.length)throw new Error("noElements");if(!a.length)throw new Error("noEvent");return function t(e){var n=e?"addEventListener":"removeEventListener";e&&(c=[]);for(var r=0;r<s.length;r++){var u=s[r];c[r]=e?O(o,i):c[r]||o;for(var l=0;l<a.length;l++)u[n]?u[n](a[l],c[r],i):u["on"+a[l]]=e?c[r]:null}return t.bind(null,!e)}("Event")};function x(t,e){return p&&w(window[t])?(n=window[t],r=e,void 0===(o=window)&&(o=null),w(n)?function(){n.apply(o,arguments),r.apply(o,arguments)}:r):window[t]=e;var n,r,o}x.bind(null,"onerror"),x.bind(null,"onload");var S="undefined"==typeof window,L="hidden";function U(){return U=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},U.apply(this,arguments)}var _=["mousemove","mousedown","touchmove","touchstart","touchend","keydown"];function T(t,e){void 0===e&&(e={});var n=function(t,e){var n=this,r=!1;return function(o){r||(t.call(n,o),r=!0,setTimeout((function(){return r=!1}),e))}}(t,e.throttle||1e4),r=[];function o(){var t=function(t){if(S)return!1;var e=S||L in document?L:["webkit","moz","ms","o"].reduce((function(t,e){var n=e+"Hidden";return!t&&n in document?n:t}),null),r="".concat(e.replace(/[H|h]idden/,""),"visibilitychange"),o=function(){Boolean(document[e])||n({type:"tabVisible"})},i=function(){return document.addEventListener(r,o)};return i(),function(){return document.removeEventListener(r,o),i}}();return r=[t].concat(_.map((function(t){return C(document,t,n)}))).concat(C(window,"load",n)).concat(C(window,"scroll",n,{capture:!0,passive:!0})),i}function i(){r.map((function(t){return t()}))}return o(),function(){return i(),o}}function j(t){var e,n,r=t.onIdle,o=t.onWakeUp,i=t.onHeartbeat,a=t.timeout,s=void 0===a?1e4:a,c=t.throttle,u=void 0===c?2e3:c,l=!1,d=!1,p=new Date,h=function(){return clearTimeout(e)};function f(t){h(),i&&!l&&i(M(p),t),o&&l&&(l=!1,o(M(n),t),p=new Date),e=setTimeout((function(){l=!0,r&&(n=new Date,r(M(p),t))}),s)}var m=T(f,{throttle:u});return{disable:function(){d=!0,l=!1,h();var t=m();return function(){return d=!1,p=new Date,f({type:"load"}),t()}},getStatus:function(){return{isIdle:l,isDisabled:d,active:l?0:M(p,d),idle:l?M(n,d):0}}}}function M(t,e){return e?0:Math.round((new Date-t)/1e3)}const D=new class{constructor({app:t,version:e,plugins:n}){return this.app=t,this.version=e,this.plugins=n,this.sessionId=i(),this.anonymousId=i(),this}storage={setItem:(t,e)=>{localStorage.setItem(t,e)},getItem:t=>localStorage.getItem(t)};page(t,e={}){const n={type:"track",event:"page",properties:t,userId:this.userId||this.sessionId,anonymousId:this.anonymousId,meta:{ts:Date.now()}};this.plugins.forEach((t=>{t?.page(n)}))}identify(t,e={}){this.userId=t,this.plugins.forEach((n=>{n?.identify(t,e)}))}track(t,e,n={}){const r={type:"track",event:t,properties:e,options:n,userId:this.userId||this.sessionId,anonymousId:this.anonymousId,meta:{ts:Date.now()}};this.plugins.forEach((t=>{t?.track(r)}))}}({app:"abimage",version:"1.0.5",plugins:[{name:"abimage-provider",config:{},initialize:({config:t})=>{window.abimageLoaded=!0},page:({payload:t})=>{const{meta:e,session:n,userId:r,properties:o}=t;l.add({event:"pageView",date:e.ts,page:e.page,session:r,properties:o})},track:({payload:t})=>{const{meta:e,userId:n,event:r,properties:o}=t;l.add({date:e.ts,page:e.page,session:n,path:o.path,event:r,properties:o})},loaded:()=>!!window.abimageLoaded}]}),{storage:N}=D,V=N.getItem("__abmg_ssi")||i();N.setItem("__abmg_ssi",V),D.identify(V);const P={timeout:6e4};function H(){D.page();const t=[],e=[...document.images],n={set images(t){this.imgs=t,this.boxes=t.map((t=>[t,t.getBoundingClientRect()]))},within([t,e]){return(this.boxes.find((([n,r])=>t>r.left&&t<r.right&&e>r.top&&e<r.bottom))||[])[0]}},r=new IntersectionObserver(((e,n)=>{e.forEach((e=>{if(e.isIntersecting)D.track("imageView",{path:window.location.pathname,image:e.target.src,width:e.target.width,height:e.target.height,screen_width:screen.availWidth,screen_height:screen.availHeight}),t.push(e.target);else{const n=t.indexOf(e.target);-1!==n&&(t.splice(n,1),D.track("imageHide",{path:window.location.pathname,image:e.target.src,width:e.target.width,height:e.target.height,screen_width:screen.availWidth,screen_height:screen.availHeight}))}}))}),{root:null,rootMargin:"0px",threshold:.7,trackVisibility:!1,delay:100});return e.forEach((t=>{console.log("starting to observe ",t),r.observe(t)})),{observer:r,images:e,imageLocations:n,visibleImages:t}}let{observer:B,images:F,visibleImages:R,imageLocations:J}=H();const W=function(){let t;return{stop:()=>{clearInterval(t)},start:()=>{t=setInterval((()=>{R.length>0&&D.track("imageViewTick",{path:window.location.pathname,images:R.map((t=>t.src))}),[...document.images].filter((t=>!F.includes(t))).forEach((t=>{console.log("starting to observe new image ",t),B.observe(t)})),F.filter((t=>![...document.images].includes(t))).forEach((t=>{R.splice(F.indexOf(t),1),B.unobserve(t)})),F=[...document.images],J.images=F,R.forEach((t=>{F.includes(t)||F.splice(F.indexOf(t),1)}))}),1e3)}}}();var q;W.start(),void 0===(q=P)&&(q={}),j(U({onIdle:t=>{D.track("idle",{path:window.location.pathname,activeTime:t}),W.stop()}},q)),function(t,e){void 0===e&&(e={}),j(U({onWakeUp:()=>{W.start(),D.track("reVisit",{path:window.location.pathname})}},e))}(0,P),window.addEventListener("popstate",(()=>{let t=H();B.disconnect(),B=t.observer,F=t.images,R=t.visibleImages,J=t.imageLocations}));const z=window.fetch;function Z(){document.querySelector(".shopify-payment-button__button").addEventListener("click",(t=>{D.track("buyButtonClick",{path:window.location.pathname})}))}window.fetch=function(){const t=arguments;return"/cart/add"===t[0]&&D.track("addToCart",{path:window.location.pathname,products:t[1].body}),z.apply(this,t)},document.addEventListener("click",(t=>{const e=t.target,n=J.within([t.screenX,t.screenY]);n&&"A"===e.tagName&&D.track("imageLinkClick",{image:n.src,text:e.innerText,link:e.href,path:window.location.pathname}),t.target&&"A"===t.target.tagName&&D.track("linkClick",{href:e.href,text:t.target.innerText,path:window.location.pathname})})),"complete"===document.readyState?Z():document.addEventListener("DOMContentLoaded",Z);

"use strict";function e(e,t,n,r,i){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:i;return e===i?n:e}var t="undefined",n="object",r=function(){},i="any",o="*",a="undefined"!=typeof process?process:{};a.env&&a.env.NODE_ENV;var u="undefined"!=typeof window;function c(e,t){return t.charAt(0)[e]()+t.slice(1)}null!=a.versions&&a.versions.node,"undefined"!=typeof Deno&&Deno.core,u&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"));var s=c.bind(null,"toUpperCase"),l=c.bind(null,"toLowerCase");function f(e){return y(e)?s("null"):"object"==typeof e?function(e){return m(e.constructor)?e.constructor.name:null}(e):Object.prototype.toString.call(e).slice(8,-1)}function d(e,t){void 0===t&&(t=!0);var n=f(e);return t?l(n):n}function p(e,t){return typeof t===e}var m=p.bind(null,"function"),g=p.bind(null,"string"),v=p.bind(null,"undefined"),h=p.bind(null,"boolean");function y(e){return null===e}function b(e){return"array"===d(e)}function w(e){if(!function(e){return e&&("object"==typeof e||null!==e)}(e))return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function I(e){return e instanceof Error||g(e.message)&&e.constructor&&function(e){return"number"===d(e)&&!isNaN(e)}(e.constructor.stackTraceLimit)}function E(e,t){if("object"!=typeof t||y(t))return!1;if(t instanceof e)return!0;var n=d(new e(""));if(I(t))for(;t;){if(d(t)===n)return!0;t=Object.getPrototypeOf(t)}return!1}function S(e,t){var n=e instanceof Element||e instanceof HTMLDocument;return n&&t?function(e,t){return void 0===t&&(t=""),e&&e.nodeName===t.toUpperCase()}(e,t):n}function P(e){var t=[].slice.call(arguments,1);return function(){return e.apply(void 0,[].slice.call(arguments).concat(t))}}function O(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function x(e){return function(e){for(var t,n=Object.create(null),r=/([^&=]+)=?([^&]*)/g;t=r.exec(e);){var i=O(t[1]),o=O(t[2]);"[]"===i.substring(i.length-2)?(n[i=i.substring(0,i.length-2)]||(n[i]=[])).push(o):n[i]=""===o||o}for(var a in n){var u=a.split("[");u.length>1&&(k(n,u.map((function(e){return e.replace(/[?[\]\\ ]/g,"")})),n[a]),delete n[a])}return n}(function(e){if(e){var t=e.match(/\?(.*)/);return t&&t[1]?t[1].split("#")[0]:""}return u&&window.location.search.substring(1)}(e))}function k(e,t,n){for(var r=t.length-1,i=0;i<r;++i){var o=t[i];if("__proto__"===o||"constructor"===o)break;o in e||(e[o]={}),e=e[o]}e[t[r]]=n}function j(){for(var e="",t=0,n=4294967295*Math.random()|0;t++<36;){var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"[t-1],i=15&n;e+="-"==r||"4"==r?r:("x"==r?i:3&i|8).toString(16),n=t%8==0?4294967295*Math.random()|0:n>>4}return e}p.bind(null,"symbol"),E.bind(null,TypeError),E.bind(null,SyntaxError),P(S,"form"),P(S,"button"),P(S,"input"),P(S,"select");var _="global",N="__global__",A=typeof self===n&&self.self===self&&self||typeof global===n&&global.global===global&&global||void 0;function T(e){return A[N][e]}function D(e,t){return A[N][e]=t}function U(e){delete A[N][e]}function z(e,t,n){var r;try{if(C(e)){var i=window[e];r=i[t].bind(i)}}catch(e){}return r||n}A[N]||(A[N]={});var M={};function C(e){if(typeof M[e]!==t)return M[e];try{var n=window[e];n.setItem(t,t),n.removeItem(t)}catch(n){return M[e]=!1}return M[e]=!0}function L(){return L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},L.apply(this,arguments)}var V="function",q="undefined",R="@@redux/"+Math.random().toString(36),$=function(){return typeof Symbol===V&&Symbol.observable||"@@observable"}(),B=" != "+V;function H(e,t,n){var r;if(typeof t===V&&typeof n===q&&(n=t,t=void 0),typeof n!==q){if(typeof n!==V)throw new Error("enhancer"+B);return n(H)(e,t)}if(typeof e!==V)throw new Error("reducer"+B);var i=e,o=t,a=[],u=a,c=!1;function s(){u===a&&(u=a.slice())}function l(){return o}function f(e){if(typeof e!==V)throw new Error("Listener"+B);var t=!0;return s(),u.push(e),function(){if(t){t=!1,s();var n=u.indexOf(e);u.splice(n,1)}}}function d(e){if(!w(e))throw new Error("Act != obj");if(typeof e.type===q)throw new Error("ActType "+q);if(c)throw new Error("Dispatch in reducer");try{c=!0,o=i(o,e)}finally{c=!1}for(var t=a=u,n=0;n<t.length;n++)(0,t[n])();return e}return d({type:"@@redux/INIT"}),(r={dispatch:d,subscribe:f,getState:l,replaceReducer:function(e){if(typeof e!==V)throw new Error("next reducer"+B);i=e,d({type:"@@redux/INIT"})}})[$]=function(){var e,t=f;return(e={subscribe:function(e){if("object"!=typeof e)throw new TypeError("Observer != obj");function n(){e.next&&e.next(l())}return n(),{unsubscribe:t(n)}}})[$]=function(){return this},e},r}function J(e,t){var n=t&&t.type;return"action "+(n&&n.toString()||"?")+"reducer "+e+" returns "+q}function W(){var e=[].slice.call(arguments);return 0===e.length?function(e){return e}:1===e.length?e[0]:e.reduce((function(e,t){return function(){return e(t.apply(void 0,[].slice.call(arguments)))}}))}function F(){var e=arguments;return function(t){return function(n,r,i){var o,a=t(n,r,i),u=a.dispatch,c={getState:a.getState,dispatch:function(e){return u(e)}};return o=[].slice.call(e).map((function(e){return e(c)})),L({},a,{dispatch:u=W.apply(void 0,o)(a.dispatch)})}}}var X="__anon_id",G="__user_id",K="__user_traits",Q="userId",Y="anonymousId",Z=["bootstrap","params","campaign","initializeStart","initialize","initializeEnd","ready","resetStart","reset","resetEnd","pageStart","page","pageEnd","pageAborted","trackStart","track","trackEnd","trackAborted","identifyStart","identify","identifyEnd","identifyAborted","userIdChanged","registerPlugins","enablePlugin","disablePlugin","online","offline","setItemStart","setItem","setItemEnd","setItemAborted","removeItemStart","removeItem","removeItemEnd","removeItemAborted"],ee=["name","EVENTS","config","loaded"],te=Z.reduce((function(e,t){return e[t]=t,e}),{registerPluginType:function(e){return"registerPlugin:"+e},pluginReadyType:function(e){return"ready:"+e}}),ne=/^utm_/,re=/^an_prop_/,ie=/^an_trait_/;function oe(e){var t=e.storage.setItem;return function(n){return function(r){return function(i){if(i.type===te.bootstrap){var o=i.params,a=i.user,u=i.persistedUser,c=i.initialUser,s=u.userId===a.userId;u.anonymousId!==a.anonymousId&&t(X,a.anonymousId),s||t(G,a.userId),c.traits&&t(K,L({},s&&u.traits?u.traits:{},c.traits));var l=Object.keys(i.params);if(l.length){var f=o.an_uid,d=o.an_event,p=l.reduce((function(e,t){if(t.match(ne)||t.match(/^(d|g)clid/)){var n=t.replace(ne,"");e.campaign["campaign"===n?"name":n]=o[t]}return t.match(re)&&(e.props[t.replace(re,"")]=o[t]),t.match(ie)&&(e.traits[t.replace(ie,"")]=o[t]),e}),{campaign:{},props:{},traits:{}});n.dispatch(L({type:te.params,raw:o},p,f?{userId:f}:{})),f&&setTimeout((function(){return e.identify(f,p.traits)}),0),d&&setTimeout((function(){return e.track(d,p.props)}),0),Object.keys(p.campaign).length&&n.dispatch({type:te.campaign,campaign:p.campaign})}}return r(i)}}}}function ae(e){return function(t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),n.type===te.setItemEnd){if(n.key===X)return L({},t,{anonymousId:n.value});if(n.key===G)return L({},t,{userId:n.value})}switch(n.type){case te.identify:return Object.assign({},t,{userId:n.userId,traits:L({},t.traits,n.traits)});case te.reset:return[G,X,K].forEach((function(t){e.removeItem(t)})),Object.assign({},t,{userId:null,anonymousId:null,traits:{}});default:return t}}}function ue(e){return{userId:e.getItem(G),anonymousId:e.getItem(X),traits:e.getItem(K)}}var ce=function(e){return"__TEMP__"+e};function se(e){var t=e.storage,n=t.setItem,r=t.removeItem,i=t.getItem;return function(e){return function(t){return function(o){var a=o.userId,u=o.traits,c=o.options;if(o.type===te.reset&&([G,K,X].forEach((function(e){r(e)})),[Q,Y,"traits"].forEach((function(e){U(ce(e))}))),o.type===te.identify){i(X)||n(X,j());var s=i(G),l=i(K)||{};s&&s!==a&&e.dispatch({type:te.userIdChanged,old:{userId:s,traits:l},new:{userId:a,traits:u},options:c}),a&&n(G,a),u&&n(K,L({},l,u))}return t(o)}}}}var le={};function fe(e,t){le[e]&&m(le[e])&&(le[e](t),delete le[e])}function de(e,t,n){return new Promise((function(r,i){return t()?r(e):n<1?i(L({},e,{queue:!0})):new Promise((function(e){return setTimeout(e,10)})).then((function(o){return de(e,t,n-10).then(r,i)}))}))}var pe=function(e){var t=e.data,n=e.action,r=e.instance,i=e.state,o=e.allPlugins,a=e.allMatches,u=e.store,c=e.EVENTS;try{var s=i.plugins,l=i.context,f=n.type,d=f.match(me),p=t.exact.map((function(e){return e.pluginName}));d&&(p=a.during.map((function(e){return e.pluginName})));var g=function(e,t){return function(n,r,i){var o=r.config,a=r.name,u=a+"."+n.type;i&&(u=i.event);var c=n.type.match(me)?function(e,t,n,r,i){return function(o,a){var u=r?r.name:e,c=a&&Se(a)?a:n;if(r&&(!(c=a&&Se(a)?a:[e]).includes(e)||1!==c.length))throw new Error("Method "+t+" can only abort "+e+" plugin. "+JSON.stringify(c)+" input valid");return L({},i,{abort:{reason:o,plugins:c,caller:t,_:u}})}}(a,u,t,i,n):function(e,t){return function(){throw new Error(e.type+" action not cancellable. Remove abort in "+t)}}(n,u);return{payload:xe(n),instance:e,config:o||{},abort:c}}}(r,p),v=t.exact.reduce((function(e,t){var n=t.pluginName,r=t.methodName,i=!1;return r.match(/^initialize/)||r.match(/^reset/)||(i=!s[n].loaded),l.offline&&r.match(/^(page|track|identify)/)&&(i=!0),e[""+n]=i,e}),{});return Promise.resolve(t.exact.reduce((function(e,i,a){var u=i.pluginName;return Promise.resolve(e).then((function(e){function i(){return Promise.resolve(e)}var a=function(){if(t.namespaced&&t.namespaced[u])return Promise.resolve(t.namespaced[u].reduce((function(e,t,n){return Promise.resolve(e).then((function(e){return t.method&&m(t.method)?(function(e,t){var n=Oe(e);if(n&&n.name===t){var r=Oe(n.method);throw new Error([t+" plugin is calling method "+e,"Plugins cant call self","Use "+n.method+" "+(r?"or "+r.method:"")+" in "+t+" plugin insteadof "+e].join("\n"))}}(t.methodName,t.pluginName),Promise.resolve(t.method({payload:e,instance:r,abort:(n=e,i=u,a=t.pluginName,function(e,t){return L({},n,{abort:{reason:e,plugins:t||[i],caller:f,from:a||i}})}),config:ye(t.pluginName,s,o),plugins:s})).then((function(t){var n=w(t)?t:{};return Promise.resolve(L({},e,n))}))):e;var n,i,a}))}),Promise.resolve(n))).then((function(t){e[u]=t}));e[u]=n}();return a&&a.then?a.then(i):i()}))}),Promise.resolve({}))).then((function(e){return Promise.resolve(t.exact.reduce((function(n,i,a){try{var c=t.exact.length===a+1,l=i.pluginName,p=o[l];return Promise.resolve(n).then((function(t){var n=e[l]?e[l]:{};if(d&&(n=t),Ie(n,l))return he({data:n,method:f,instance:r,pluginName:l,store:u}),Promise.resolve(t);if(Ie(t,l))return c&&he({data:t,method:f,instance:r,store:u}),Promise.resolve(t);if(v.hasOwnProperty(l)&&!0===v[l])return u.dispatch({type:"queue",plugin:l,payload:n,_:{called:"queue",from:"queueMechanism"}}),Promise.resolve(t);var i=g(e[l],o[l]);return Promise.resolve(p[f]({abort:i.abort,payload:n,instance:r,config:ye(l,s,o),plugins:s})).then((function(i){var o=w(i)?i:{},a=L({},t,o),c=e[l];if(Ie(c,l))he({data:c,method:f,instance:r,pluginName:l,store:u});else{var s=f+":"+l;(s.match(/:/g)||[]).length<2&&!f.match(ge)&&!f.match(ve)&&r.dispatch(L({},d?a:n,{type:s,_:{called:s,from:"submethod"}}))}return Promise.resolve(a)}))}))}catch(e){return Promise.reject(e)}}),Promise.resolve(n))).then((function(e){if(!(f.match(me)||f.match(/^registerPlugin/)||f.match(ve)||f.match(ge)||f.match(/^params/)||f.match(/^userIdChanged/))){if(c.plugins.includes(f),e._&&e._.originalAction===f)return e;var n=L({},e,{_:{originalAction:e.type,called:e.type,from:"engineEnd"}});Ee(e,t.exact.length)&&!f.match(/End$/)&&(n=L({},n,{type:e.type+"Aborted"})),u.dispatch(n)}return e}))}))}catch(e){return Promise.reject(e)}},me=/Start$/,ge=/^bootstrap/,ve=/^ready/;function he(e){var t=e.pluginName,n=e.method+"Aborted"+(t?":"+t:"");e.store.dispatch(L({},e.data,{type:n,_:{called:n,from:"abort"}}))}function ye(e,t,n){var r=t[e]||n[e];return r&&r.config?r.config:{}}function be(e,t){return t.reduce((function(t,n){return n[e]?t.concat({methodName:e,pluginName:n.name,method:n[e]}):t}),[])}function we(e,t){var n=e.replace(me,""),r=t?":"+t:"";return[""+e+r,""+n+r,n+"End"+r]}function Ie(e,t){var n=e.abort;return!!n&&(!0===n||Pe(n,t)||n&&Pe(n.plugins,t))}function Ee(e,t){var n=e.abort;if(!n)return!1;if(!0===n||g(n))return!0;var r=n.plugins;return Se(n)&&n.length===t||Se(r)&&r.length===t}function Se(e){return Array.isArray(e)}function Pe(e,t){return!(!e||!Se(e))&&e.includes(t)}function Oe(e){var t=e.match(/(.*):(.*)/);return!!t&&{method:t[1],name:t[2]}}function xe(e){return Object.keys(e).reduce((function(t,n){return"type"===n||(t[n]=w(e[n])?Object.assign({},e[n]):e[n]),t}),{})}function ke(e,t,n){var r={};return function(i){return function(o){return function(a){try{var u,c=function(e){return u?e:o(f)},s=a.type,l=a.plugins,f=a;if(a.abort)return Promise.resolve(o(a));if(s===te.enablePlugin&&i.dispatch({type:te.initializeStart,plugins:l,disabled:[],fromEnable:!0,meta:a.meta}),s===te.disablePlugin&&setTimeout((function(){return fe(a.meta.rid,{payload:a})}),0),s===te.initializeEnd){var d=t(),p=Object.keys(d),g=p.filter((function(e){return l.includes(e)})).map((function(e){return d[e]})),v=[],y=[],b=a.disabled,w=g.map((function(e){var t=e.name;return de(e,e.loaded,1e4).then((function(n){return r[t]||(i.dispatch({type:te.pluginReadyType(t),name:t,events:Object.keys(e).filter((function(e){return!ee.includes(e)}))}),r[t]=!0),v=v.concat(t),e})).catch((function(e){if(e instanceof Error)throw new Error(e);return y=y.concat(e.name),e}))}));Promise.all(w).then((function(e){var t={plugins:v,failed:y,disabled:b};setTimeout((function(){p.length===w.length+b.length&&i.dispatch(L({},{type:te.ready},t))}),0)}))}var I=function(){if(s!==te.bootstrap)return/^ready:([^:]*)$/.test(s)&&setTimeout((function(){return function(e,t,n){var r=t(),i=e.getState(),o=i.plugins,a=i.queue,u=i.user;if(!i.context.offline&&a&&a.actions&&a.actions.length){var c=a.actions.reduce((function(e,t,n){return o[t.plugin].loaded?(e.process.push(t),e.processIndex.push(n)):(e.requeue.push(t),e.requeueIndex.push(n)),e}),{processIndex:[],process:[],requeue:[],requeueIndex:[]});if(c.processIndex&&c.processIndex.length){c.processIndex.forEach((function(t){var i=a.actions[t],c=i.plugin,s=i.payload.type,l=r[c][s];if(l&&m(l)){var f=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),[Q,Y].reduce((function(n,r){return e.hasOwnProperty(r)&&t[r]&&t[r]!==e[r]&&(n[r]=t[r]),n}),e)}(i.payload,u);l({payload:f,config:o[c].config,instance:n});var d=s+":"+c;e.dispatch(L({},f,{type:d,_:{called:d,from:"queueDrain"}}))}}));var s=a.actions.filter((function(e,t){return!~c.processIndex.indexOf(t)}));a.actions=s}}}(i,t,e)}),0),Promise.resolve(function(e,t,n,r,i){try{var o=m(t)?t():t,a=e.type,u=a.replace(me,"");if(e._&&e._.called)return Promise.resolve(e);var c=n.getState(),s=(d=o,void 0===(p=c.plugins)&&(p={}),void 0===(g=e.options)&&(g={}),Object.keys(d).filter((function(e){var t=g.plugins||{};return h(t[e])?t[e]:!1!==t.all&&(!p[e]||!1!==p[e].enabled)})).map((function(e){return d[e]})));a===te.initializeStart&&e.fromEnable&&(s=Object.keys(c.plugins).filter((function(t){var n=c.plugins[t];return e.plugins.includes(t)&&!n.initialized})).map((function(e){return o[e]})));var l=s.map((function(e){return e.name})),f=function(e,t,n){var r=we(e).map((function(e){return be(e,t)}));return t.reduce((function(n,r){var i=r.name,o=we(e,i).map((function(e){return be(e,t)})),a=o[0],u=o[1],c=o[2];return a.length&&(n.beforeNS[i]=a),u.length&&(n.duringNS[i]=u),c.length&&(n.afterNS[i]=c),n}),{before:r[0],beforeNS:{},during:r[1],duringNS:{},after:r[2],afterNS:{}})}(a,s);return Promise.resolve(pe({action:e,data:{exact:f.before,namespaced:f.beforeNS},state:c,allPlugins:o,allMatches:f,instance:n,store:r,EVENTS:i})).then((function(e){function t(){var t=function(){if(a.match(me))return Promise.resolve(pe({action:L({},s,{type:u+"End"}),data:{exact:f.after,namespaced:f.afterNS},state:c,allPlugins:o,allMatches:f,instance:n,store:r,EVENTS:i})).then((function(e){e.meta&&e.meta.hasCallback&&fe(e.meta.rid,{payload:e})}))}();return t&&t.then?t.then((function(){return e})):e}if(Ee(e,l.length))return e;var s,d=function(){if(a!==u)return Promise.resolve(pe({action:L({},e,{type:u}),data:{exact:f.during,namespaced:f.duringNS},state:c,allPlugins:o,allMatches:f,instance:n,store:r,EVENTS:i})).then((function(e){s=e}));s=e}();return d&&d.then?d.then(t):t()}))}catch(e){return Promise.reject(e)}var d,p,g}(a,t,e,i,n)).then((function(e){var t=o(e);return u=1,t}))}();return Promise.resolve(I&&I.then?I.then(c):c(I))}catch(e){return Promise.reject(e)}}}}}function je(e){return function(t){return function(t){return function(n){var r=n.type,i=n.key,o=n.value,a=n.options;if(r===te.setItem||r===te.removeItem){if(n.abort)return t(n);r===te.setItem?e.setItem(i,o,a):e.removeItem(i,a)}return t(n)}}}}var _e=function(){var e=this;this.before=[],this.after=[],this.addMiddleware=function(t,n){e[n]=e[n].concat(t)},this.removeMiddleware=function(t,n){var r=e[n].findIndex((function(e){return e===t}));-1!==r&&(e[n]=[].concat(e[n].slice(0,r),e[n].slice(r+1)))},this.dynamicMiddlewares=function(t){return function(n){return function(r){return function(i){var o={getState:n.getState,dispatch:function(e){return n.dispatch(e)}},a=e[t].map((function(e){return e(o)}));return W.apply(void 0,a)(r)(i)}}}}};function Ne(e){return function(t,n){void 0===t&&(t={});var r={};if("initialize:aborted"===n.type)return t;if(/^registerPlugin:([^:]*)$/.test(n.type)){var i=Ae(n.type,"registerPlugin"),o=e()[i];if(!o||!i)return t;var a=n.enabled;return r[i]={enabled:a,initialized:!!a&&Boolean(!o.initialize),loaded:!!a&&Boolean(o.loaded()),config:o.config||{}},L({},t,r)}if(/^initialize:([^:]*)$/.test(n.type)){var u=Ae(n.type,te.initialize),c=e()[u];return c&&u?(r[u]=L({},t[u],{initialized:!0,loaded:Boolean(c.loaded())}),L({},t,r)):t}if(/^ready:([^:]*)$/.test(n.type))return r[n.name]=L({},t[n.name],{loaded:!0}),L({},t,r);switch(n.type){case te.disablePlugin:return L({},t,Te(n.plugins,!1,t));case te.enablePlugin:return L({},t,Te(n.plugins,!0,t));default:return t}}}function Ae(e,t){return e.substring(t.length+1,e.length)}function Te(e,t,n){return e.reduce((function(e,r){return e[r]=L({},n[r],{enabled:t}),e}),n)}function De(e){try{return JSON.parse(JSON.stringify(e))}catch(e){}return e}var Ue={last:{},history:[]};function ze(e,t){void 0===e&&(e=Ue);var n=t.options,r=t.meta;if(t.type===te.track){var i=De(L({event:t.event,properties:t.properties},Object.keys(n).length&&{options:n},{meta:r}));return L({},e,{last:i,history:e.history.concat(i)})}return e}var Me={actions:[]};function Ce(e,t){void 0===e&&(e=Me);var n=t.payload;switch(t.type){case"queue":var r;return r=n&&n.type&&n.type===te.identify?[t].concat(e.actions):e.actions.concat(t),L({},e,{actions:r});case"dequeue":return[];default:return e}}var Le=/#.*$/;function Ve(e){var t=/(http[s]?:\/\/)?([^\/\s]+\/)(.*)/g.exec(e);return"/"+(t&&t[3]?t[3].split("?")[0].replace(Le,""):"")}var qe,Re=function(e){if(void 0===e&&(e={}),!u)return e;var t=document,n=t.title,r=t.referrer,i=window,o=i.location,a=i.innerWidth,c=i.innerHeight,s=o.hash,l=o.search,f=function(e){var t=function(){if(u)for(var e,t=document.getElementsByTagName("link"),n=0;e=t[n];n++)if("canonical"===e.getAttribute("rel"))return e.getAttribute("href")}();return t?t.match(/\?/)?t:t+e:window.location.href.replace(Le,"")}(l),d={title:n,url:f,path:Ve(f),hash:s,search:l,width:a,height:c};return r&&""!==r&&(d.referrer=r),L({},d,e)},$e={last:{},history:[]};function Be(e,t){void 0===e&&(e=$e);var n=t.options;if(t.type===te.page){var r=De(L({properties:t.properties,meta:t.meta},Object.keys(n).length&&{options:n}));return L({},e,{last:r,history:e.history.concat(r)})}return e}qe={};var He={initialized:!1,sessionId:j(),app:null,version:null,debug:!1,offline:!!u&&!navigator.onLine,os:{name:"na"},userAgent:u?navigator.userAgent:"node",library:{name:"analytics",version:"0.11.0"},timezone:void 0,locale:void 0,campaign:{},referrer:qe};function Je(e,t){void 0===e&&(e=He);var n=e.initialized,r=t.campaign;switch(t.type){case te.campaign:return L({},e,{campaign:r});case te.offline:return L({},e,{offline:!0});case te.online:return L({},e,{offline:!1});default:return n?e:L({},He,e,{initialized:!0})}}var We=["plugins","reducers","storage"];function Fe(){return D("analytics",[]),function(e){return function(t,n,r){var i=e(t,n,r),o=i.dispatch;return Object.assign(i,{dispatch:function(e){return A[N].analytics.push(e.action||e),o(e)}})}}}function Xe(e){return function(){return W(W.apply(null,arguments),Fe())}}function Ge(e){return e?b(e)?e:[e]:[]}function Ke(e,t,n){void 0===e&&(e={});var r,i,o=j();return t&&(le[o]=(r=t,i=function(e){for(var t,n=e||Array.prototype.slice.call(arguments),r=0;r<n.length;r++)if(m(n[r])){t=n[r];break}return t}(n),function(e){i&&i(e),r(e)})),L({},e,{rid:o,ts:(new Date).getTime()},t?{hasCallback:!0}:{})}function Qe(t){void 0===t&&(t={});var n=t.reducers||{},r=t.initialUser||{},i=(t.plugins||[]).reduce((function(e,t){if(m(t))return e.middlewares=e.middlewares.concat(t),e;if(t.NAMESPACE&&(t.name=t.NAMESPACE),!t.name)throw new Error("https://lytics.dev/errors/1");var n=t.EVENTS?Object.keys(t.EVENTS).map((function(e){return t.EVENTS[e]})):[];e.pluginEnabled[t.name]=!(!1===t.enabled||t.config&&!1===t.config.enabled),delete t.enabled,t.methods&&(e.methods[t.name]=Object.keys(t.methods).reduce((function(e,n){var r;return e[n]=(r=t.methods[n],function(){for(var e=Array.prototype.slice.call(arguments),t=new Array(r.length),n=0;n<e.length;n++)t[n]=e[n];return t[t.length]=O,r.apply({instance:O},t)}),e}),{}),delete t.methods);var r=Object.keys(t).concat(n),i=new Set(e.events.concat(r));if(e.events=Array.from(i),e.pluginsArray=e.pluginsArray.concat(t),e.plugins[t.name])throw new Error(t.name+"AlreadyLoaded");return e.plugins[t.name]=t,e.plugins[t.name].loaded||(e.plugins[t.name].loaded=function(){return!0}),e}),{plugins:{},pluginEnabled:{},methods:{},pluginsArray:[],middlewares:[],events:[]}),o=t.storage?t.storage:{getItem:T,setItem:D,removeItem:U},a=function(e){return function(t,n,r){return n.getState("user")[t]||(r&&w(r)&&r[t]?r[t]:ue(e)[t]||T(ce(t))||null)}}(o),c=i.plugins,s=i.events.filter((function(e){return!ee.includes(e)})).sort(),l=new Set(s.concat(Z).filter((function(e){return!ee.includes(e)}))),f=Array.from(l).sort(),d=function(){return c},p=new _e,v=p.addMiddleware,h=p.removeMiddleware,y=p.dynamicMiddlewares,b=function(){throw new Error("Abort disabled inListener")},I=x(),E=ue(o),S=L({},E,r,I.an_uid?{userId:I.an_uid}:{},I.an_aid?{anonymousId:I.an_aid}:{});S.anonymousId||(S.anonymousId=j());var P=L({enable:function(e,t){return new Promise((function(n){G.dispatch({type:te.enablePlugin,plugins:Ge(e),_:{originalAction:te.enablePlugin}},n,[t])}))},disable:function(e,t){return new Promise((function(n){G.dispatch({type:te.disablePlugin,plugins:Ge(e),_:{originalAction:te.disablePlugin}},n,[t])}))}},i.methods),O={identify:function(e,t,n,r){try{var i=g(e)?e:null,o=w(e)?e:t,u=n||{},c=O.user();D(ce(Q),i);var s=i||o.userId||a(Q,O,o);return Promise.resolve(new Promise((function(e){G.dispatch(L({type:te.identifyStart,userId:s,traits:o||{},options:u,anonymousId:c.anonymousId},c.id&&c.id!==i&&{previousId:c.id}),e,[t,n,r])})))}catch(e){return Promise.reject(e)}},track:function(e,t,n,r){try{var i=w(e)?e.event:e;if(!i||!g(i))throw new Error("EventMissing");var o=w(e)?e:t||{},u=w(n)?n:{};return Promise.resolve(new Promise((function(e){G.dispatch({type:te.trackStart,event:i,properties:o,options:u,userId:a(Q,O,t),anonymousId:a(Y,O,t)},e,[t,n,r])})))}catch(e){return Promise.reject(e)}},page:function(e,t,n){try{var r=w(e)?e:{},i=w(t)?t:{};return Promise.resolve(new Promise((function(o){G.dispatch({type:te.pageStart,properties:Re(r),options:i,userId:a(Q,O,r),anonymousId:a(Y,O,r)},o,[e,t,n])})))}catch(e){return Promise.reject(e)}},user:function(t){if(t===Q||"id"===t)return a(Q,O);if(t===Y||"anonId"===t)return a(Y,O);var n=O.getState("user");return t?e(n,t):n},reset:function(e){return new Promise((function(t){G.dispatch({type:te.resetStart},t,e)}))},ready:function(e){return O.on(te.ready,e)},on:function(e,t){if(!e||!m(t))return!1;if(e===te.bootstrap)throw new Error(".on disabled for "+e);var n=/Start$|Start:/;if("*"===e){var r=function(e){return function(e){return function(r){return r.type.match(n)&&t({payload:r,instance:O,plugins:c}),e(r)}}},i=function(e){return function(e){return function(r){return r.type.match(n)||t({payload:r,instance:O,plugins:c}),e(r)}}};return v(r,Ye),v(i,Ze),function(){h(r,Ye),h(i,Ze)}}var o=e.match(n)?Ye:Ze,a=function(n){return function(n){return function(r){return r.type===e&&t({payload:r,instance:O,plugins:c,abort:b}),n(r)}}};return v(a,o),function(){return h(a,o)}},once:function(e,t){if(!e||!m(t))return!1;if(e===te.bootstrap)throw new Error(".once disabled for "+e);var n=O.on(e,(function(e){t({payload:e.payload,instance:O,plugins:c,abort:b}),n()}));return n},getState:function(t){var n=G.getState();return t?e(n,t):Object.assign({},n)},dispatch:function(e){var t=g(e)?{type:e}:e;if(Z.includes(t.type))throw new Error("reserved action "+t.type);var n=L({},t,{_:L({originalAction:t.type},e._||{})});G.dispatch(n)},enablePlugin:P.enable,disablePlugin:P.disable,plugins:P,storage:{getItem:o.getItem,setItem:function(e,t,n){G.dispatch({type:te.setItemStart,key:e,value:t,options:n})},removeItem:function(e,t){G.dispatch({type:te.removeItemStart,key:e,options:t})}},setAnonymousId:function(e,t){O.storage.setItem(X,e,t)},events:{core:Z,plugins:s}},k=i.middlewares.concat([function(e){return function(e){return function(t){return t.meta||(t.meta=Ke()),e(t)}}},y(Ye),ke(O,d,{all:f,plugins:s}),je(o),oe(O),se(O),y(Ze)]),_={context:Je,user:ae(o),page:Be,track:ze,plugins:Ne(d),queue:Ce},N=W,A=W;if(u&&t.debug){var z=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;z&&(N=z({trace:!0,traceLimit:25})),A=function(){return 0===arguments.length?Fe():w(typeof arguments[0])?Xe():Xe().apply(null,arguments)}}var M,C=function(e){return Object.keys(e).reduce((function(t,n){return We.includes(n)||(t[n]=e[n]),t}),{})}(t),$=i.pluginsArray.reduce((function(e,t){var n=t.name,r=t.config,o=t.loaded,a=i.pluginEnabled[n];return e[n]={enabled:a,initialized:!!a&&Boolean(!t.initialize),loaded:Boolean(o()),config:r||{}},e}),{}),B={context:C,user:S,plugins:$},G=H(function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];typeof e[i]===V&&(n[i]=e[i])}var o,a=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(typeof n(void 0,{type:"@@redux/INIT"})===q||typeof n(void 0,{type:R})===q)throw new Error("reducer "+t+" "+q)}))}(n)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var r=!1,i={},u=0;u<a.length;u++){var c=a[u],s=e[c],l=(0,n[c])(s,t);if(typeof l===q){var f=J(c,t);throw new Error(f)}i[c]=l,r=r||l!==s}return r?i:e}}(L({},_,n)),B,A(N(F.apply(void 0,k))));G.dispatch=(M=G.dispatch,function(e,t,n){var r=L({},e,{meta:Ke(e.meta,t,Ge(n))});return M.apply(null,[r])});var K=Object.keys(c);G.dispatch({type:te.bootstrap,plugins:K,config:C,params:I,user:S,initialUser:r,persistedUser:E});var ne=K.filter((function(e){return i.pluginEnabled[e]})),re=K.filter((function(e){return!i.pluginEnabled[e]}));return G.dispatch({type:te.registerPlugins,plugins:K,enabled:i.pluginEnabled}),i.pluginsArray.map((function(e,t){var n=e.bootstrap,r=e.config,o=e.name;n&&m(n)&&n({instance:O,config:r,payload:e}),G.dispatch({type:te.registerPluginType(o),name:o,enabled:i.pluginEnabled[o],plugin:e}),i.pluginsArray.length===t+1&&G.dispatch({type:te.initializeStart,plugins:ne,disabled:re})})),O}var Ye="before",Ze="after",et="cookie",tt=ot(),nt=at,rt=at;function it(e){return tt?at(e,"",-1):U(e)}function ot(){if(void 0!==tt)return tt;var e="cookiecookie";try{at(e,e),tt=-1!==document.cookie.indexOf(e),it(e)}catch(e){tt=!1}return tt}function at(e,t,n,r,i,o){if("undefined"!=typeof window){var a=arguments.length>1;return!1===tt&&(a?D(e,t):T(e)),a?document.cookie=e+"="+encodeURIComponent(t)+(n?"; expires="+new Date(+new Date+1e3*n).toUTCString()+(r?"; path="+r:"")+(i?"; domain="+i:"")+(o?"; secure":""):""):decodeURIComponent((("; "+document.cookie).split("; "+e+"=")[1]||"").split(";")[0])}}var ut="localStorage",ct=C.bind(null,"localStorage");z("localStorage","getItem",T),z("localStorage","setItem",D),z("localStorage","removeItem",U);var st="sessionStorage",lt=C.bind(null,"sessionStorage");function ft(e){var t=e;try{if("true"===(t=JSON.parse(e)))return!0;if("false"===t)return!1;if(w(t))return t;parseFloat(t)===t&&(t=parseFloat(t))}catch(e){}if(null!==t&&""!==t)return t}z("sessionStorage","getItem",T),z("sessionStorage","setItem",D),z("sessionStorage","removeItem",U);var dt=ct(),pt=lt(),mt=ot();function gt(e,t){if(e){var n=vt(t),r=!wt(n),i=ht(n)?ft(localStorage.getItem(e)):void 0;if(r&&!v(i))return i;var o=yt(n)?ft(nt(e)):void 0;if(r&&o)return o;var a=bt(n)?ft(sessionStorage.getItem(e)):void 0;if(r&&a)return a;var u=T(e);return r?u:{localStorage:i,sessionStorage:a,cookie:o,global:u}}}function vt(e){return e?g(e)?e:e.storage:i}function ht(e){return dt&&It(e,ut)}function yt(e){return mt&&It(e,et)}function bt(e){return pt&&It(e,st)}function wt(e){return e===o||"all"===e}function It(e,t){return e===i||e===t||wt(e)}function Et(e,t,n){return{location:e,current:t,previous:n}}var St={setItem:function(e,t,n){if(e&&!v(t)){var r={},i=vt(n),o=JSON.stringify(t),a=!wt(i);return ht(i)&&(r[ut]=Et(ut,t,ft(localStorage.getItem(e))),localStorage.setItem(e,o),a)?r[ut]:yt(i)&&(r[et]=Et(et,t,ft(nt(e))),rt(e,o),a)?r[et]:bt(i)&&(r[st]=Et(st,t,ft(sessionStorage.getItem(e))),sessionStorage.setItem(e,o),a)?r[st]:(r[_]=Et(_,t,T(e)),D(e,t),a?r[_]:r)}},getItem:gt,removeItem:function(e,t){if(e){var n=vt(t),r=gt(e,o),i={};return!v(r.localStorage)&&ht(n)&&(localStorage.removeItem(e),i[ut]=r.localStorage),!v(r.cookie)&&yt(n)&&(it(e),i[et]=r.cookie),!v(r.sessionStorage)&&bt(n)&&(sessionStorage.removeItem(e),i[st]=r.sessionStorage),!v(r.global)&&It(n,_)&&(U(e),i[_]=r.global),i}}};function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){Pt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let kt;const jt=new Uint8Array(16);function _t(){if(!kt&&(kt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!kt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return kt(jt)}const Nt=[];for(let e=0;e<256;++e)Nt.push((e+256).toString(16).slice(1));var At={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};const Tt=new class{constructor(){this.items=[],this.head=0,this.tail=0}add(e){this.items.push(e),this.tail++}remove(){const e=this.items[this.head];return this.items.splice(this.head,1),this.head++,e}getAll(){return this.items.slice(this.head)}isEmpty(){return this.head===this.tail}size(){return this.tail-this.head}clear(){this.items=[],this.head=0,this.tail=0}};function Dt(e,t){if(g(e))return t?Dt(document.querySelectorAll(e)):e.split(" ").map((function(e){return e.trim()}));if(NodeList.prototype.isPrototypeOf(e)){for(var n=[],r=e.length>>>0;r--;)n[r]=e[r];return n}return function(e){return e?b(e)?e:[e]:[]}(e)}function Ut(e,t){return t&&t.once?function(e,t){var n;return function(){return e&&(n=e.apply(t||this,arguments),e=null),n}}(e):e}setInterval((()=>{const e=Tt.getAll();e.length>0&&(fetch("https://abimagedev-production.up.railway.app/track",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),Tt.clear())}),1e3);var zt=function(e){return function(t,n,i,o){var a=i||r;if(!u)return a;var c=o||!1,s=Dt(n),l=Dt(t,!0),f=[];if(!l.length)throw new Error("noElements");if(!s.length)throw new Error("noEvent");return function e(t){var n=t?"addEventListener":"removeEventListener";t&&(f=[]);for(var r=0;r<l.length;r++){var i=l[r];f[r]=t?Ut(a,c):f[r]||a;for(var o=0;o<s.length;o++)i[n]?i[n](s[o],f[r],c):i["on"+s[o]]=t?f[r]:null}return e.bind(null,!t)}(e)}}("Event");function Mt(e,t){return u&&m(window[e])?(n=window[e],r=t,void 0===(i=window)&&(i=null),m(n)?function(){n.apply(i,arguments),r.apply(i,arguments)}:r):window[e]=t;var n,r,i}Mt.bind(null,"onerror"),Mt.bind(null,"onload");var Ct="undefined"==typeof window,Lt="hidden";function Vt(e){if(Ct)return!1;var t,n=(t=["webkit","moz","ms","o"],Ct||Lt in document?Lt:t.reduce((function(e,t){var n=t+"Hidden";return!e&&n in document?n:e}),null)),r="".concat(n.replace(/[H|h]idden/,""),"visibilitychange"),i=function(){return e(Boolean(document[n]))},o=function(){return document.addEventListener(r,i)};return o(),function(){return document.removeEventListener(r,i),o}}function qt(){return qt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qt.apply(this,arguments)}var Rt=["mousemove","mousedown","touchmove","touchstart","touchend","keydown"];function $t(e,t){void 0===t&&(t={});var n=function(e,t){var n=this,r=!1;return function(i){r||(e.call(n,i),r=!0,setTimeout((function(){return r=!1}),t))}}(e,t.throttle||1e4),r=[];function i(){var e=Vt((function(e){e||n({type:"tabVisible"})}));return r=[e].concat(Rt.map((function(e){return zt(document,e,n)}))).concat(zt(window,"load",n)).concat(zt(window,"scroll",n,{capture:!0,passive:!0})),o}function o(){r.map((function(e){return e()}))}return i(),function(){return o(),i}}function Bt(e){var t,n,r=e.onIdle,i=e.onWakeUp,o=e.onHeartbeat,a=e.timeout,u=void 0===a?1e4:a,c=e.throttle,s=void 0===c?2e3:c,l=!1,f=!1,d=new Date,p=function(){return clearTimeout(t)};function m(e){p(),o&&!l&&o(Ht(d),e),i&&l&&(l=!1,i(Ht(n),e),d=new Date),t=setTimeout((function(){l=!0,r&&(n=new Date,r(Ht(d),e))}),u)}var g=$t(m,{throttle:s});return{disable:function(){f=!0,l=!1,p();var e=g();return function(){return f=!1,d=new Date,m({type:"load"}),e()}},getStatus:function(){return{isIdle:l,isDisabled:f,active:l?0:Ht(d,f),idle:l?Ht(n,f):0}}}}function Ht(e,t){return t?0:Math.round((new Date-e)/1e3)}const Jt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Qe(xt(xt({},{storage:St}),e))}({app:"abimage",version:"1.0.4",plugins:[{name:"abimage-provider",config:{},initialize:({config:e})=>{window.abimageLoaded=!0},page:({payload:e})=>{console.log("page ",e);const{meta:t,session:n,userId:r,properties:i}=e;Tt.add({event:"pageView",date:t.ts,rid:t.rid,page:t.page,session:r,properties:i})},track:({payload:e})=>{console.log("tarcking ",e);const{meta:t,userId:n,event:r,properties:i}=e;Tt.add({date:t.ts,rid:t.rid,page:t.page,session:n,event:r,properties:i})},loaded:()=>!!window.abimageLoaded}]}),{storage:Wt}=Jt,Ft=Wt.getItem("__abmg_ssi")||function(e,t,n){if(At.randomUUID&&!t&&!e)return At.randomUUID();const r=(e=e||{}).random||(e.rng||_t)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return(Nt[e[t+0]]+Nt[e[t+1]]+Nt[e[t+2]]+Nt[e[t+3]]+"-"+Nt[e[t+4]]+Nt[e[t+5]]+"-"+Nt[e[t+6]]+Nt[e[t+7]]+"-"+Nt[e[t+8]]+Nt[e[t+9]]+"-"+Nt[e[t+10]]+Nt[e[t+11]]+Nt[e[t+12]]+Nt[e[t+13]]+Nt[e[t+14]]+Nt[e[t+15]]).toLowerCase()}(r)}();Wt.setItem("__abmg_ssi",Ft),Jt.identify(Ft);const Xt={timeout:6e4};function Gt(){Jt.page();const e=[],t=[...document.images],n=new IntersectionObserver(((t,n)=>{t.forEach((t=>{if(t.isIntersecting)Jt.track("imageView",{image:t.target.src,width:t.target.width,height:t.target.height,screen_width:screen.availWidth,screen_height:screen.availHeight}),e.push(t.target.src);else{const n=e.indexOf(t.target.src);-1!==n&&(e.splice(n,1),Jt.track("imageHide",{image:t.target.src}))}}))}),{root:null,rootMargin:"0px",threshold:.5});return t.forEach((e=>{n.observe(e)})),{observer:n,images:t,visibleImages:e}}let{observer:Kt,images:Qt,visibleImages:Yt}=Gt();const Zt=function(){let e;return{stop:()=>{clearInterval(e)},start:()=>{e=setInterval((()=>{Yt.length>0&&Jt.track("imageViewTick",{images:Yt});const e=[...document.images].filter((e=>!Qt.includes(e)));e.forEach((e=>{Kt.observe(e)})),Qt.forEach((t=>{e.includes(t)||Kt.unobserve(t)})),Qt.splice(0,Qt.length,...e),Yt.forEach((t=>{e.includes(t)||Yt.splice(Yt.indexOf(t),1)}))}),1e4)}}}();Zt.start(),function(e,t){void 0===t&&(t={}),Bt(qt({onIdle:e},t))}((e=>{Zt.stop()}),Xt),function(e,t){void 0===t&&(t={}),Bt(qt({onWakeUp:e},t))}((()=>{Zt.start(),Jt.track("reVisit")}),Xt),window.addEventListener("popstate",(()=>{let e=Gt();Kt=e.observer,Qt=e.images,Yt=e.visibleImages}));const en=window.fetch;window.fetch=function(){const e=arguments;return"/cart/add"===e[0]&&Jt.track("addToCart",{products:e[1].body}),en.apply(this,e)},document.addEventListener("click",(e=>{e.target&&"A"===e.target.tagName&&Jt.track("linkClick",{href:e.target.href,text:e.target.innerText})}));
